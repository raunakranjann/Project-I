<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Attendance Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">

<div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6">

    <!-- HEADER -->
    <div class="flex flex-col md:flex-row justify-between items-center border-b pb-4 mb-6">
        <h2 class="text-2xl font-bold text-gray-800">
            Attendance Report
        </h2>

        <div class="flex gap-3 mt-4 md:mt-0">
            <!-- EXPORT (SAFE) -->
            <a th:href="@{/admin/attendance/export(
                    date=${date},
                    subject=${subject},
                    teacher=${teacher},
                    status=${status}
                )}"
               class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-semibold">
                Download Excel
            </a>

            <a th:href="@{/admin/dashboard}"
               class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition">
                Back to Dashboard
            </a>
        </div>
    </div>

    <!-- FILTERS -->
    <form method="get"
          th:action="@{/admin/attendance}"
          class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">

        <!-- DATE -->
        <input type="date"
               name="date"
               th:value="${date}"
               class="border rounded-lg px-3 py-2">

        <!-- SUBJECT -->
        <input type="text"
               name="subject"
               placeholder="Subject"
               th:value="${subject}"
               class="border rounded-lg px-3 py-2">

        <!-- TEACHER -->
        <input type="text"
               name="teacher"
               placeholder="Teacher"
               th:value="${teacher}"
               class="border rounded-lg px-3 py-2">

        <!-- STATUS -->
        <select name="status"
                class="border rounded-lg px-3 py-2">
            <option value="">All Status</option>
            <option value="PRESENT"
                    th:selected="${status == 'PRESENT'}">
                Present
            </option>
            <option value="ABSENT"
                    th:selected="${status == 'ABSENT'}">
                Absent
            </option>
        </select>

        <button type="submit"
                class="bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
            Apply Filters
        </button>
    </form>

    <!-- TABLE -->
    <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">

            <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2 border">User ID</th>
                <th class="px-4 py-2 border">Roll No</th>
                <th class="px-4 py-2 border">Student</th>

                <th class="px-4 py-2 border">Class ID</th>
                <th class="px-4 py-2 border">Subject</th>
                <th class="px-4 py-2 border">Teacher</th>

                <th class="px-4 py-2 border">Date</th>
                <th class="px-4 py-2 border">Time</th>
                <th class="px-4 py-2 border">Status</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="a : ${records}" class="hover:bg-gray-50">

                <td class="px-4 py-2 border" th:text="${a.userId}"></td>
                <td class="px-4 py-2 border" th:text="${a.rollNo}"></td>
                <td class="px-4 py-2 border" th:text="${a.userName}"></td>

                <td class="px-4 py-2 border" th:text="${a.classId}"></td>
                <td class="px-4 py-2 border" th:text="${a.subjectName}"></td>
                <td class="px-4 py-2 border" th:text="${a.teacherName}"></td>

                <td class="px-4 py-2 border" th:text="${a.date}"></td>
                <td class="px-4 py-2 border" th:text="${a.timestamp}"></td>

                <td class="px-4 py-2 border font-semibold"
                    th:text="${a.status}"
                    th:classappend="
                        ${a.status == 'PRESENT'} ? 'text-green-600' :
                        (${a.status == 'ABSENT'} ? 'text-red-600' : 'text-gray-600')
                    ">
                </td>
            </tr>

            <!-- EMPTY STATE -->
            <tr th:if="${#lists.isEmpty(records)}">
                <td colspan="9" class="text-center py-6 text-gray-500">
                    No attendance records found.
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

</body>
</html>
